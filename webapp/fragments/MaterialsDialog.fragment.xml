<core:FragmentDefinition xmlns="sap.m" xmlns:core="sap.ui.core">
  <Dialog id="dlgMateriais"
          icon="sap-icon://wrench"
          contentWidth="auto"
          horizontalScrolling="false">

    <customHeader>
      <Bar>
        <contentLeft>
          <core:Icon src="sap-icon://wrench" size="1.5rem"/>
          <Title text="{dlg>/titulo}" level="H2"/>
        </contentLeft>
        <contentRight>
          <Button icon="sap-icon://decline" type="Transparent" press=".onCloseMateriais"/>
        </contentRight>
      </Bar>
    </customHeader>

    <content>
      <VBox renderType="Bare">
        <Table id="tblMat"
               items="{dlg>/materiais}"
               sticky="ColumnHeaders"
               autoPopinMode="true"
               growing="true"
               growingScrollToLoad="true"
               noDataText="Sem materiais/serviços no período selecionado">

          <columns>
            <Column width="22rem"><Label text="Item"/></Column>
            <Column width="7rem"><Label text="Tipo"/></Column>
            <Column width="5rem" hAlign="End" minScreenWidth="Tablet" demandPopin="true"><Label text="Qtde"/></Column>
            <Column width="5rem" minScreenWidth="Desktop" demandPopin="true"><Label text="Unid"/></Column>
            <Column width="8rem" hAlign="End" minScreenWidth="Tablet" demandPopin="true"><Label text="Custo Unit."/></Column>
            <Column width="9rem" hAlign="End"><Label text="Total (R$)"/></Column>
            <Column width="9rem" hAlign="Center" minScreenWidth="Desktop" demandPopin="true"><Label text="Status"/></Column>
            <Column width="8rem" minScreenWidth="Desktop" demandPopin="true"><Label text="Cód. Material"/></Column>
            <Column width="7rem" minScreenWidth="Desktop" demandPopin="true"><Label text="Depósito"/></Column>
            <Column width="6rem" minScreenWidth="Desktop" demandPopin="true"><Label text="Hora"/></Column>
            <Column width="8rem" minScreenWidth="Desktop" demandPopin="true"><Label text="Data"/></Column>
            <Column width="8rem" minScreenWidth="Desktop" demandPopin="true"><Label text="N. Ordem"/></Column>
            <Column width="8rem" minScreenWidth="Desktop" demandPopin="true"><Label text="N. Reserva"/></Column>
            <Column width="10rem" minScreenWidth="Desktop" demandPopin="true"><Label text="Recebedor"/></Column>
            <Column width="10rem" minScreenWidth="Desktop" demandPopin="true"><Label text="Usuário"/></Column>
          </columns>

          <items>
            <ColumnListItem vAlign="Middle">
              <cells>
                <Text class="wrapText" maxLines="3" text="{dlg>nome}" tooltip="{dlg>nome}"/>
                <ObjectStatus
                  text="{path:'dlg>tipo', formatter:'.formatter.getTipoText'}"
                  class="{path:'dlg>tipo', formatter:'.formatter.getTipoClass'}"
                  tooltip="{dlg>tipo}"/>
                <ObjectNumber number="{dlg>qtde}" class="end"/>
                <Text text="{dlg>unid}" class="center"/>
                <ObjectNumber number="{path:'dlg>custoUnit', formatter:'.formatter.fmtBrl'}"/>
                <ObjectNumber number="{
                  parts:['dlg>qtde','dlg>custoUnit'],
                  formatter:'.formatter.fmtTotalItemBrl'
                }"/>
                <Text text="DEVOLUÇÃO"
                      visible="{path:'dlg>qtde', formatter:'.formatter.isDevolucao'}"
                      class="blinkingText"/>
                <Text text="{dlg>codMaterial}" class="nowrap" tooltip="{dlg>codMaterial}"/>
                <Text text="{dlg>deposito}"/>
                <Text text="{path:'dlg>horaEntrada', formatter:'.formatter.fmtHora'}" class="center"/>
                <Text text="{path:'dlg>data', formatter:'.formatter.fmtDate'}" class="center"/>
                <Text text="{dlg>nOrdem}" class="nowrap" tooltip="{dlg>nOrdem}"/>
                <Text text="{dlg>nReserva}" class="nowrap" tooltip="{dlg>nReserva}"/>
                <Text text="{dlg>recebedor}" class="wrapText" maxLines="2" tooltip="{dlg>recebedor}"/>
                <Text text="{dlg>usuario}" class="nowrap" tooltip="{dlg>usuario}"/>
              </cells>
            </ColumnListItem>
          </items>
        </Table>

        <Toolbar class="sapUiTinyMarginTop">
          <ToolbarSpacer/>
          <ObjectStatus text="Total itens:"/>
          <ObjectNumber number="{dlg>/totalItens}"/>
          <ToolbarSeparator/>
          <ObjectStatus text="Total materiais/serviços:"/>
          <ObjectNumber number="{path:'dlg>/totalValor', formatter:'.formatter.fmtBrl'}"/>
        </Toolbar>

        <Text text="Sem materiais para este veículo no período"
              visible="{= ${dlg>/materiais}.length === 0 }"/>
      </VBox>
    </content>

    <buttons>
      <Button text="Exportar CSV" type="Emphasized"
              press=".onExportMateriais"
              enabled="{= ${dlg>/materiais}.length > 0 }"/>
      <Button text="Imprimir"
              press=".onPrintMateriais"
              enabled="{= ${dlg>/materiais}.length > 0 }"/>
      <Button text="Fechar" type="Transparent" press=".onCloseMateriais"/>
    </buttons>
  </Dialog>
</core:FragmentDefinition>
