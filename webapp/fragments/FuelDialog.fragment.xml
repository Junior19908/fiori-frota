<core:FragmentDefinition xmlns="sap.m" xmlns:core="sap.ui.core">
  <Dialog id="dlgFuel"
          title="{fuel>/titulo}"
          icon="sap-icon://gas-station"
          contentWidth="auto"
          horizontalScrolling="false">

    <content>
  <VBox id="vboxFuel" renderType="Bare">
        <Table id="tblFuel"
               items="{fuel>/eventos}"
               growing="true"
               growingScrollToLoad="true"
               noDataText="Sem abastecimentos no período selecionado">
          <columns>
            <Column id="colData"><Label id="lblData" text="Data"/></Column>
            <Column id="colHora" minScreenWidth="Phone" demandPopin="true"><Label id="lblHora" text="Hora"/></Column>

            <Column id="colComboio" minScreenWidth="Phone" demandPopin="true">
              <Label id="lblComboio" text="Ponto de Abastecimento"/>
            </Column>

            <Column id="colKm" hAlign="End" minScreenWidth="Tablet" demandPopin="true">
              <Label id="lblKm" text="Km"/>
            </Column>

            <Column id="colHr" hAlign="End" minScreenWidth="Tablet" demandPopin="true">
              <Label id="lblHr" text="Hr"/>
            </Column>

            <Column id="colLitros" hAlign="End">
              <Label id="lblLitros" text="Litros"/>
            </Column>

            <Column id="colKmL" hAlign="End" minScreenWidth="Tablet" demandPopin="true">
              <Label id="lblKmL" text="Km/L"/>
            </Column>

            <Column id="colLHr" hAlign="End" minScreenWidth="Desktop" demandPopin="true">
              <Label id="lblLHr" text="L/Hr"/>
            </Column>
          </columns>

          <items>
            <ColumnListItem id="cliFuel">
              <cells>
                <Text id="txtData" text="{path:'fuel>data', formatter:'.formatter.fmtDate'}"/>
                <Text id="txtHora" text="{path:'fuel>hora', formatter:'.formatter.fmtHora'}"/>
                <Text id="txtComboio" text="{fuel>comboio}"/>

                <!-- Km: se o seu JSON usa outro campo (quilometragem/hodometro), mantenha o cálculo no controller como já está -->
                <ObjectNumber id="objKm" number="{path:'fuel>km', formatter:'.formatter.fmtKm'}"/>

                <!-- Horas -->
                <ObjectNumber id="objHr" number="{path:'fuel>hr', formatter:'.formatter.fmtNum'}"/>

                <!-- Litros -->
                <ObjectNumber id="objLitros" number="{path:'fuel>litros', formatter:'.formatter.fmtLitros'}"/>

                <!-- Km/L (já calculado no controller em _kmPorL) -->
                <ObjectNumber id="objKmPorL" number="{path:'fuel>_kmPorL', formatter:'.formatter.fmtNum'}"
                              visible="{= ${fuel>_kmPorL} > 0 }"/>

                <!-- L/Hr (vamos calcular média global no rodapé; por linha pode vir vazio se não houver delta de horas entre eventos) -->
                <ObjectNumber id="objLPorHr" number="{path:'fuel>_lPorHr', formatter:'.formatter.fmtNum'}"
                              visible="{= ${fuel>_lPorHr} > 0 }"/>
              </cells>
            </ColumnListItem>
          </items>
        </Table>

        <!-- Rodapé com totais/médias do período -->
        <Toolbar id="tbFuelFooter" class="sapUiTinyMarginTop">
          <ToolbarSpacer id="tbspacer1"/>
          <ObjectStatus id="osTotalLitros" text="Total Litros:"/>
          <ObjectNumber id="objTotalLitros" number="{path:'fuel>/totalLitros', formatter:'.formatter.fmtLitros'}"/>

          <ToolbarSeparator id="tbsep1"/>

          <ObjectStatus id="osMediaKmL" text="Média Km/L:"/>
          <ObjectNumber id="objMediaKmPorL" number="{path:'fuel>/mediaKmPorL', formatter:'.formatter.fmtNum'}"/>

          <ToolbarSeparator id="tbsep2"/>

          <ObjectStatus id="osMediaLHr" text="Média L/Hr:"/>
          <ObjectNumber id="objMediaLPorHr" number="{path:'fuel>/mediaLPorHr', formatter:'.formatter.fmtNum'}"/>
        </Toolbar>

        <!-- Mensagem vazio alternativa (opcional) -->
        <Text id="txtNoEvents" text="Sem abastecimentos para este veículo no período"
              visible="{= ${fuel>/eventos}.length === 0 }"/>
      </VBox>
    </content>

    <buttons>
      <Button id="btnCloseFuel" text="Fechar" type="Transparent" press=".onCloseFuel"/>
    </buttons>
  </Dialog>
</core:FragmentDefinition>
