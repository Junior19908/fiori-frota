<core:FragmentDefinition xmlns="sap.m" xmlns:core="sap.ui.core">
  <Dialog id="dlgFuel"
          title="{fuel>/titulo}"
          icon="sap-icon://gas-station"
          contentWidth="auto"
          horizontalScrolling="false">

    <content>
      <VBox id="vboxFuel" renderType="Bare">
        <Table id="tblFuel"
               items="{fuel>/eventos}"
               growing="true"
               growingScrollToLoad="true"
               noDataText="Sem abastecimentos no período selecionado">

          <columns>
            <Column id="colData" width="7rem"><Label text="Data"/></Column>
            <Column id="colHora" width="7rem" minScreenWidth="Phone" demandPopin="true"><Label text="Hora"/></Column>

            <!-- Ponto de Abastecimento (Comboio/Posto) -->
            <Column id="colComboio" width="12rem" hAlign="Center" minScreenWidth="Phone" demandPopin="true">
              <Label text="Ponto de Abastecimento"/>
            </Column>

            <!-- STATUS -->
            <Column id="colStatus" hAlign="Center" minScreenWidth="Tablet" demandPopin="true">
              <Label text="STATUS"/>
            </Column>

            <Column id="colKm" width="7rem" hAlign="End" minScreenWidth="Tablet" demandPopin="true">
              <Label text="Km"/>
            </Column>

            <Column id="colHr" width="7rem" hAlign="End" minScreenWidth="Tablet" demandPopin="true">
              <Label text="Hr"/>
            </Column>

            <Column id="colLitros" width="7rem" hAlign="End">
              <Label text="Litros"/>
            </Column>

            <Column id="colKmL" width="7rem" hAlign="Center" minScreenWidth="Tablet" demandPopin="true">
              <Label text="Km/L"/>
            </Column>

            <Column id="colLHr" width="7rem" hAlign="Center" minScreenWidth="Desktop" demandPopin="true">
              <Label text="L/Hr"/>
            </Column>
          </columns>

          <items>
            <ColumnListItem id="cliFuel">
              <cells>
                <Text text="{path:'fuel>data', formatter:'.formatter.fmtDate'}"/>
                <Text text="{path:'fuel>hora', formatter:'.formatter.fmtHora'}"/>

                <!-- Comboio/Posto -->
                <Text text="{fuel>comboio}"/>

                <!-- STATUS: erro/alerta + badge 'Leitura anterior' quando usar prev externo -->
                <HBox justifyContent="Start" alignItems="Center">
                  <ObjectStatus
                    text="{fuel>_statusText}"
                    state="{fuel>_statusState}"
                    icon="{= ${fuel>_statusIcon} || '' }"
                    tooltip="{fuel>_statusTooltip}"
                    visible="{= !!${fuel>_statusText} }"/>

                  <ObjectStatus
                    class="sapUiTinyMarginBegin"
                    text="{= ${fuel>_prevBadgeText} || 'Leitura anterior' }"
                    state="Information"
                    icon="sap-icon://hint"
                    tooltip="{fuel>_prevBadgeTooltip}"
                    visible="{fuel>_usesPrev}"/>
                </HBox>

                <!-- Km -->
                <ObjectNumber number="{path:'fuel>km', formatter:'.formatter.fmtKm'}"/>

                <!-- Hr -->
                <ObjectNumber number="{path:'fuel>hr', formatter:'.formatter.fmtNum'}"/>

                <!-- Litros -->
                <ObjectNumber number="{path:'fuel>litros', formatter:'.formatter.fmtLitros'}"/>

                <!-- Km/L -->
                <ObjectNumber number="{path:'fuel>_kmPorL', formatter:'.formatter.fmtNum'}"
                              visible="{= ${fuel>_kmPorL} > 0 }"/>

                <!-- L/Hr -->
                <ObjectNumber number="{path:'fuel>_lPorHr', formatter:'.formatter.fmtNum'}"
                              visible="{= ${fuel>_lPorHr} > 0 }"/>
              </cells>
            </ColumnListItem>
          </items>
        </Table>

        <!-- Rodapé: totais/Médias -->
        <Toolbar class="sapUiTinyMarginTop">
          <ToolbarSpacer/>
          <ObjectStatus text="Total Litros:"/>
          <ObjectNumber number="{path:'fuel>/totalLitros', formatter:'.formatter.fmtLitros'}"/>

          <ToolbarSeparator/>

          <!-- Totais de deslocamento no período -->
          <ObjectStatus text="Total Km:" visible="{fuel>/limiteKmVisible}"/>
          <ObjectNumber number="{path:'fuel>/totalKm', formatter:'.formatter.fmtNum'}" visible="{fuel>/limiteKmVisible}"/>

          <ToolbarSeparator visible="{= ${fuel>/limiteKmVisible} &amp;&amp; ${fuel>/limiteHrVisible} }"/>

          <ObjectStatus text="Total Hr:" visible="{fuel>/limiteHrVisible}"/>
          <ObjectNumber number="{path:'fuel>/totalHr', formatter:'.formatter.fmtNum'}" visible="{fuel>/limiteHrVisible}"/>

          <ToolbarSeparator/>

          <ObjectStatus text="Média Km/L:"/>
          <ObjectNumber number="{path:'fuel>/mediaKmPorL', formatter:'.formatter.fmtNum'}"/>

          <ToolbarSeparator/>

          <ObjectStatus text="Média L/Hr:"/>
          <ObjectNumber number="{path:'fuel>/mediaLPorHr', formatter:'.formatter.fmtNum'}"/>
        </Toolbar>

        <!-- Ajuste manual de limites -->
        <Toolbar visible="{fuel>/limiteToolbarVisible}">
          <ToolbarSpacer/>
          <HBox alignItems="Center" visible="{fuel>/limiteKmVisible}">
            <Label text="Km:"/>
            <Text text="Mín." class="sapUiTinyMarginBegin"/>
            <StepInput value="{fuel>/limiteKmMin}" min="0" max="999999" step="10" change=".onLimiteKmMinChange" enabled="{fuel>/limiteKmEnabled}" displayValuePrecision="0" width="6rem" class="sapUiTinyMarginBegin"/>
            <Text text="Máx." class="sapUiTinyMarginBegin"/>
            <StepInput value="{fuel>/limiteKm}" min="0" max="999999" step="10" change=".onLimiteKmChange" enabled="{fuel>/limiteKmEnabled}" displayValuePrecision="0" width="6rem" class="sapUiTinyMarginBegin"/>
            <Text text="{fuel>/limiteKmHint}" class="sapUiSmallMarginBegin"/>
          </HBox>

          <ToolbarSeparator visible="{= ${fuel>/limiteKmVisible} &amp;&amp; ${fuel>/limiteHrVisible} }"/>

          <HBox alignItems="Center" visible="{fuel>/limiteHrVisible}">
            <Label text="Hr:"/>
            <Text text="Mín." class="sapUiTinyMarginBegin"/>
            <StepInput value="{fuel>/limiteHrMin}" min="0" max="9999" step="1" change=".onLimiteHrMinChange" enabled="{fuel>/limiteHrEnabled}" displayValuePrecision="0" width="5rem" class="sapUiTinyMarginBegin"/>
            <Text text="Máx." class="sapUiTinyMarginBegin"/>
            <StepInput value="{fuel>/limiteHr}" min="0" max="9999" step="1" change=".onLimiteHrChange" enabled="{fuel>/limiteHrEnabled}" displayValuePrecision="0" width="5rem" class="sapUiTinyMarginBegin"/>
            <Text text="{fuel>/limiteHrHint}" class="sapUiSmallMarginBegin"/>
          </HBox>
        </Toolbar>

        <Text text="Sem abastecimentos para este veículo no período"
              visible="{= ${fuel>/eventos}.length === 0 }"/>
      </VBox>
    </content>

    <buttons>
      <Button text="Salvar" type="Emphasized" press=".onSaveFuelLimits"/>
      <Button text="Fechar" type="Transparent" press=".onCloseFuel"/>
    </buttons>
  </Dialog>
</core:FragmentDefinition>

