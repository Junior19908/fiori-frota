<core:FragmentDefinition xmlns="sap.m" xmlns:core="sap.ui.core" xmlns:table="sap.ui.table">
  <Dialog id="dlgOS"
          icon="sap-icon://activity-items"
          contentWidth="auto"
          contentHeight="auto"
          horizontalScrolling="false"
          resizable="true"
          draggable="true"
          stretchOnPhone="true">

    <customHeader>
      <Bar>
        <contentLeft>
          <core:Icon src="sap-icon://activity-items" size="1.5rem"/>
          <Title text="{osDlg>/titulo}" level="H2"/>
        </contentLeft>
        <contentRight>
          <Button icon="sap-icon://decline" type="Transparent" press=".onCloseOS"/>
        </contentRight>
      </Bar>
    </customHeader>

    <content>
      <VBox renderType="Bare">
<Toolbar>
  <Button text="Concluir selecionadas" icon="sap-icon://accept" type="Emphasized" enabled="{= ${osDlg>/os}.length > 0 }" press=".onCloseSelectedOS"/>
  <Button text="Definir tipo" icon="sap-icon://edit" type="Transparent" enabled="{= ${osDlg>/os}.length > 0 }" press=".onSetTypeSelectedOS"/>
  <ToolbarSpacer/>
  <Button text="Anterior" icon="sap-icon://navigation-left-arrow" type="Transparent" enabled="{= !!${osDlg>/page} && !!${osDlg>/page/hasPrev} }" press=".onPrevPage"/>
  <Text text="{osDlg>/page/pageText}"/>
  <Button text="Próxima" icon="sap-icon://navigation-right-arrow" type="Transparent" enabled="{= !!${osDlg>/page} && !!${osDlg>/page/hasNext} }" press=".onNextPage"/>
  <ToolbarSeparator/>
  <SearchField width="22rem" placeholder="Filtrar por veículo, ordem ou título" liveChange=".onLiveSearch"/>
</Toolbar>

        <table:Table id="tblOSGrid"
                     rows="{osDlg>/os}"
                     selectionMode="MultiToggle"
                     enableColumnReordering="true"
                     enableBusyIndicator="true"
                     rowHeight="32"
                     columnHeaderHeight="36"
                     width="100%"
                     visibleRowCountMode="Auto"
                     minAutoRowCount="10"
                     fixedColumnCount="2"
                     noDataText="Sem OS para exibir">

          <table:columns>
            <!-- AÃ§Ã£o: Detalhes da OS -->
            <table:Column width="3rem" hAlign="Center">
              <Label text=""/>
              <table:template>
                <Button icon="sap-icon://inspect" type="Transparent" tooltip="Detalhes"
                        press=".onShowOSDetails"/>
              </table:template>
            </table:Column>

            <table:Column width="7rem" sortProperty="veiculo" filterProperty="veiculo" hAlign="Begin">
              <Label text="VeÃ­culo" textAlign="Center" width="100%"/>
              <table:template>
                <Text text="{osDlg>veiculo}" tooltip="{osDlg>veiculo}"/>
              </table:template>
            </table:Column>

            <table:Column width="8rem" sortProperty="ordem" filterProperty="ordem" hAlign="End">
              <Label text="Ordem" textAlign="Center" width="100%"/>
              <table:template>
                <Text text="{osDlg>ordem}" tooltip="{osDlg>ordem}"/>
              </table:template>
            </table:Column>

            <table:Column width="22rem" sortProperty="titulo" filterProperty="titulo" hAlign="Begin">
              <Label text="TÃ­tulo" textAlign="Center" width="100%"/>
              <table:template>
                <Text text="{osDlg>titulo}" tooltip="{osDlg>titulo}" wrapping="true"/>
              </table:template>
            </table:Column>

            <table:Column width="10rem" sortProperty="inicio" hAlign="Center">
              <Label text="InÃ­cio" textAlign="Center" width="100%"/>
              <table:template>
                <Text text="{ parts: [ {path:'osDlg>inicio'}, {path:'osDlg>horaInicio'} ], formatter: '.formatter.fmtDateTime' }"/>
              </table:template>
            </table:Column>

            <table:Column width="7rem" sortProperty="horaInicio" hAlign="Center" visible="false">
              <Label text="Hora InÃ­cio" textAlign="Center" width="100%"/>
              <table:template>
                <Text text="{ path: 'osDlg>horaInicio', formatter: '.formatter.fmtHora' }"/>
              </table:template>
            </table:Column>

            <table:Column width="10rem" sortProperty="fim" hAlign="Center">
              <Label text="Fim" textAlign="Center" width="100%"/>
              <table:template>
                <Text text="{ parts: [ {path:'osDlg>fim'}, {path:'osDlg>horaFim'} ], formatter: '.formatter.fmtDateTime' }"/>
              </table:template>
            </table:Column>

            <table:Column width="7rem" sortProperty="horaFim" hAlign="Center" visible="false">
              <Label text="Hora Fim" textAlign="Center" width="100%"/>
              <table:template>
                <Text text="{ path: 'osDlg>horaFim', formatter: '.formatter.fmtHora' }"
                      visible="{= !!${osDlg>horaFim} && ${osDlg>horaFim} !== '00:00' }"/>
              </table:template>
            </table:Column>

            <table:Column width="8rem" hAlign="Center">
              <Label text="Parada" textAlign="Center" width="100%"/>
              <table:template>
                <ObjectStatus text="{= ${osDlg>parada} ? 'Sim' : 'NÃ£o' }"
                              state="{= ${osDlg>parada} ? 'Error' : 'Success' }"/>
              </table:template>
            </table:Column>

            <table:Column width="9rem" hAlign="End">
              <Label text="Inatividade" textAlign="Center" width="100%"/>
              <table:template>
                <Text text="{osDlg>downtimeFmt}"/>
              </table:template>
            </table:Column>

            <!-- DuraÃ§Ã£o (Progress Bar) -->
            <table:Column width="18rem" hAlign="Center">
              <Label text="DuraÃ§Ã£o" textAlign="Center" width="100%"/>
              <table:template>
                <ProgressIndicator width="100%"
                                   percentValue="{ parts: [ {path:'osDlg>downtime'}, {path:'osDlg>/__stats/max'} ], formatter: '.formatter.hoursPctOfMax' }"
                                   displayValue="{osDlg>downtimeFmt}"
                                   state="{ path:'osDlg>categoria', formatter: '.formatter.osTypeState' }"/>
              </table:template>
            </table:Column>

            <table:Column width="12rem" sortProperty="tipoLabel" filterProperty="tipoLabel" hAlign="Center">
              <Label text="Tipo OS" textAlign="Center" width="100%"/>
              <table:template>
                <ObjectStatus text="{osDlg>tipoLabel}"
                              state="{ path:'osDlg>categoria', formatter: '.formatter.osTypeState' }"/>
              </table:template>
            </table:Column>

            <table:Column width="10rem" sortProperty="tipoManual" filterProperty="tipoManual" hAlign="Center">
              <Label text="Tipo (manual)" textAlign="Center" width="100%"/>
              <table:template>
                <Text text="{osDlg>tipoManual}"/>
              </table:template>
            </table:Column>
          </table:columns>
        </table:Table>

        <Toolbar class="sapUiTinyMarginTop">
          <ToolbarSpacer/>
          <ObjectStatus text="Total OS:"/>
          <ObjectNumber number="{osDlg>/total}"/>
        </Toolbar>

        <Text text="Sem OS para o filtro"
              visible="{= ${osDlg>/os}.length === 0 }"/>
      </VBox>
    </content>

    <buttons>
      <Button text="Exportar CSV" type="Emphasized"
              press=".onExportOS"
              enabled="{= ${osDlg>/os}.length > 0 }"/>
      <Button text="Fechar" type="Transparent" press=".onCloseOS"/>
    </buttons>
  </Dialog>
</core:FragmentDefinition>
