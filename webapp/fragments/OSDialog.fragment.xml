<core:FragmentDefinition xmlns="sap.m" xmlns:core="sap.ui.core" xmlns:table="sap.ui.table">
  <Dialog id="dlgOS"
          icon="sap-icon://activity-items"
          contentWidth="auto"
          contentHeight="auto"
          horizontalScrolling="false"
          resizable="true"
          draggable="true"
          stretchOnPhone="true">

    <customHeader>
      <Bar>
        <contentLeft>
          <core:Icon src="sap-icon://activity-items" size="1.5rem"/>
          <Title text="{osDlg>/titulo}" level="H2"/>
        </contentLeft>
        <contentRight>
          <Button icon="sap-icon://decline" type="Transparent" press=".onCloseOS"/>
        </contentRight>
      </Bar>
    </customHeader>

    <content>
      <VBox renderType="Bare">
        <Toolbar>
          <Button text="Concluir selecionadas" icon="sap-icon://accept" type="Emphasized" enabled="{= ${osDlg>/os}.length > 0 }" press=".onCloseSelectedOS"/>
          <Button text="Definir tipo" icon="sap-icon://edit" type="Transparent" enabled="{= ${osDlg>/os}.length > 0 }" press=".onSetTypeSelectedOS"/>
          <ToolbarSpacer/>
          <SearchField width="22rem" placeholder="Filtrar por veiculo, ordem ou titulo" liveChange=".onLiveSearch"/>
        </Toolbar>

        <table:Table id="tblOSGrid"
                     rows="{osDlg>/os}"
                     selectionMode="MultiToggle"
                     enableColumnReordering="true"
                     enableBusyIndicator="true"
                     rowHeight="32"
                     columnHeaderHeight="36"
                     width="100%"
                     visibleRowCountMode="Auto"
                     minAutoRowCount="10"
                     fixedColumnCount="5"
                     noDataText="Sem OS para exibir">

          <table:columns>
            <!-- Duracao: Detalhes da OS -->
            <table:Column width="5rem" hAlign="Center">
              <Label text=""/>
              <table:template>
                <Button icon="sap-icon://inspect" type="Transparent" tooltip="Detalhes"
                        press=".onShowOSDetails"/>
              </table:template>
            </table:Column>	

            <table:Column width="6rem" sortProperty="ordem" filterProperty="ordem" hAlign="End">
              <Label text="Ordem" textAlign="Center" width="100%"/>
              <table:template>
                <Text text="{osDlg>ordem}" tooltip="{osDlg>ordem}"/>
              </table:template>
            </table:Column>
			
			      <table:Column width="6rem" sortProperty="tipoLabel" filterProperty="tipoLabel" hAlign="Center">
              <Label text="Tipo OS" textAlign="Center" width="100%"/>
              <table:template>
                <ObjectStatus text="{osDlg>tipoLabel}"
                              state="{ path:'osDlg>categoria', formatter: '.formatter.osTypeState' }"/>
              </table:template>
            </table:Column>

            <table:Column width="22rem" sortProperty="titulo" filterProperty="titulo" hAlign="Begin">
              <Label text="Titulo" textAlign="Center" width="100%"/>
              <table:template>
                <Text text="{osDlg>titulo}" tooltip="{osDlg>titulo}" wrapping="true"/>
              </table:template>
            </table:Column>

            <table:Column width="10rem" sortProperty="inicio" hAlign="Center">
              <Label text="Inicio" textAlign="Center" width="100%"/>
              <table:template>
                <Text text="{ parts: [ {path:'osDlg>inicio'}, {path:'osDlg>horaInicio'} ], formatter: '.formatter.fmtDateTime' }"/>
              </table:template>
            </table:Column>

            <table:Column width="7rem" sortProperty="horaInicio" hAlign="Center" visible="false">
              <Label text="Hora Inicio" textAlign="Center" width="100%"/>
              <table:template>
                <Text text="{ path: 'osDlg>horaInicio', formatter: '.formatter.fmtHora' }"/>
              </table:template>
            </table:Column>

            <table:Column width="10rem" sortProperty="fim" hAlign="Center">
              <Label text="Fim" textAlign="Center" width="100%"/>
              <table:template>
                <Text text="{ parts: [ {path:'osDlg>fim'}, {path:'osDlg>horaFim'} ], formatter: '.formatter.fmtDateTime' }"/>
              </table:template>
            </table:Column>
			
            <table:Column width="9rem" hAlign="End">
              <Label text="Inatividade" textAlign="Center" width="100%"/>
              <table:template>
                <Text text="{osDlg>_overlapFmt}"/>
              </table:template>
            </table:Column>

            <table:Column width="8rem" hAlign="Center">
              <Label text="Parada" textAlign="Center" width="100%"/>
              <table:template>
                <ObjectStatus text="{= ${osDlg>parada} ? 'Sim' : 'NÃ£o' }"
                              state="{= ${osDlg>parada} ? 'Error' : 'Success' }"/>
              </table:template>
            </table:Column>

          </table:columns>
        </table:Table>

        <Toolbar class="sapUiTinyMarginTop">
          <ToolbarSpacer/>
          <ObjectStatus text="Total OS:"/>
          <ObjectNumber number="{osDlg>/total}"/>
          <ToolbarSeparator/>
          <ObjectStatus text="Total horas:"/>
          <ObjectNumber number="{osDlg>/totalHorasFmt}"/>
        </Toolbar>

        <Text text="Sem OS para o filtro"
              visible="{= ${osDlg>/os}.length === 0 }"/>
      </VBox>
    </content>

    <buttons>
      <Button text="Exportar CSV" type="Emphasized"
              press=".onExportOS"
              enabled="{= ${osDlg>/os}.length > 0 }"/>
      <Button text="Fechar" type="Transparent" press=".onCloseOS"/>
    </buttons>
  </Dialog>
</core:FragmentDefinition>
